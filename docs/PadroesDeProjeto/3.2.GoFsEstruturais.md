# 3.2 GoFs Estruturais ‚Äì Padr√£o Decorator

## Introdu√ß√£o

O padr√£o **Decorator**, pertencente ao grupo de padr√µes estruturais definidos pela Gang of Four (GoF), tem como objetivo adicionar responsabilidades adicionais a um objeto dinamicamente. Os decoradores fornecem uma alternativa flex√≠vel √† heran√ßa para estender funcionalidades, envolvendo o objeto original em um novo objeto "decorador" que possui a mesma interface, mas adiciona o novo comportamento.

Neste contexto, o padr√£o foi aplicado com o objetivo de adicionar comportamentos dinamicamente aos componentes do sistema de cadastro de pets. A implementa√ß√£o permite que funcionalidades, como valida√ß√µes ou notifica√ß√µes de eventos, sejam "anexadas" aos objetos de pet sem modificar suas classes originais.

Essa abordagem promove um design mais flex√≠vel, reutiliz√°vel e aderente aos princ√≠pios SOLID, em especial o Open/Closed Principle (aberto para extens√£o, fechado para modifica√ß√£o), permitindo que o sistema evolua de forma coesa sem alterar o c√≥digo-fonte existente dos componentes centrais.

---

## Metodologia

A implementa√ß√£o foi organizada com base nos pap√©is definidos pelo padr√£o Decorator, resultando na seguinte estrutura:

1. **Componente (Interface)** ‚Äî `cadastro_pet`: define o contrato que todos os componentes e decoradores devem seguir, contendo o m√©todo abstrato `cadastrar(pet)`.
2. **Componente Concreto** ‚Äî `cadastro_pet_simples`: implementa√ß√£o b√°sica do cadastro de pets, respons√°vel por persistir o pet no banco de dados.
3. **Decorator Abstrato** ‚Äî `cadastro_pet_decorator`: mant√©m uma refer√™ncia a um objeto `cadastro_pet` e delega chamadas ao m√©todo `cadastrar(pet)`.
4. **Decoradores Concretos** ‚Äî adicionam funcionalidades espec√≠ficas:
   - `autenticador_decorator`: verifica permiss√µes antes do cadastro.  
   - `validador_decorator`: valida os dados do pet.  
   - `notificador_decorator`: envia notifica√ß√µes ap√≥s o cadastro.

Essa estrutura permite a **composi√ß√£o din√¢mica** de funcionalidades. Assim, o mesmo objeto `cadastro_pet_simples` pode ser envolvido por v√°rios decoradores, empilhando comportamentos de autentica√ß√£o, valida√ß√£o e notifica√ß√£o sem alterar o c√≥digo principal.

---

## Tabela de Participa√ß√£o

| Integrante           | Fun√ß√£o desempenhada                                                | Contribui√ß√£o (%) |
|----------------------|--------------------------------------------------------------------|------------------|
| **Wallyson Souza**   | Documenta√ß√£o t√©cnica e ajustes de consist√™ncia entre classes | 25%              |
| **Mateus de Castro** | Implementa√ß√£o dos decoradores concretos e testes pr√°ticos           | 35%              |
| **Davi de Aguiar**   | Estrutura√ß√£o do padr√£o Decorator e integra√ß√£o com a l√≥gica de cadastro        | 40%             |

---

## Resultados

A ado√ß√£o do padr√£o Decorator no **CuidaDeMim** proporcionou uma arquitetura **modular e expans√≠vel**, facilitando a adi√ß√£o de novas camadas de comportamento sem modificar o c√≥digo existente.  
O sistema agora permite que opera√ß√µes de autentica√ß√£o, valida√ß√£o e notifica√ß√£o sejam executadas de forma **encadeada**, mantendo a **separa√ß√£o de responsabilidades** entre as classes.

Isso garante maior facilidade de manuten√ß√£o e evolu√ß√£o do sistema, j√° que novos decoradores podem ser adicionados com impacto m√≠nimo no restante da aplica√ß√£o.

---
## Diagrama de Classes

![Diagrama de Classes Decorators](../image/Diagrama_uml_decorators.png)

---
## Descri√ß√£o das Classes

### `cadastroPet`
**Tipo:** Interface Base (Componente)  
Define o contrato que os componentes concretos e decoradores devem seguir, por meio do m√©todo `cadastrar(pet)`.  
Garante que todos os elementos do padr√£o compartilhem a mesma assinatura de comportamento.

---

### `cadastroPetSimples`
**Tipo:** Componente Concreto  
Implementa o m√≥dulo `CadastroPet`.  
Realiza o cadastro simples do pet no banco de dados, retornando um hash com o status e a mensagem do processo.

---

### `cadastroPetDecorator`
**Tipo:** Decorator Abstrato  
Mant√©m uma refer√™ncia a um objeto que implementa `CadastroPet` e delega a execu√ß√£o do m√©todo `cadastrar(pet)`.  
Serve de base para todos os decoradores concretos do sistema.

---

### `validadorDecorator`
**Tipo:** Decorador Concreto  
Adiciona a funcionalidade de valida√ß√£o de dados do pet antes do cadastro, verificando se campos obrigat√≥rios est√£o preenchidos e se as informa√ß√µes s√£o v√°lidas.

---

### `autenticadorDecorator`
**Tipo:** Decorador Concreto  
Inclui a autentica√ß√£o de usu√°rio no processo de cadastro, garantindo que apenas usu√°rios autorizados possam registrar novos pets.

---

### `notificador_decorator.rb`
**Tipo:** Decorador Concreto  
Respons√°vel por enviar notifica√ß√µes (por e-mail, SMS ou log) ap√≥s o cadastro bem-sucedido do pet.

---

## C√≥digo das Classes

### `app/services/cadastro_pet.rb`
```ruby
# frozen_string_literal: true

# Interface base para o cadastro de pets (Componente do padr√£o Decorator)
# Define o contrato que todos os componentes concretos e decoradores devem seguir
module CadastroPet
  # M√©todo principal que realiza o cadastro do pet
  # @param pet [Pet] O objeto pet a ser cadastrado
  # @return [Hash] Resultado do cadastro com status e mensagem
  def cadastrar(pet)
    raise NotImplementedError, "#{self.class} deve implementar o m√©todo 'cadastrar'"
  end
end
```
---
### `app/services/cadastro_pet_simples.rb`
```ruby
# frozen_string_literal: true

# Componente concreto que implementa o cadastro b√°sico de pets
# Responsabilidade: Realizar o cadastro simples do pet no banco de dados
class CadastroPetSimples
  include CadastroPet

  # Realiza o cadastro simples do pet
  # @param pet [Pet] O objeto pet a ser cadastrado
  # @return [Hash] Resultado do cadastro com status e mensagem
  def cadastrar(pet)
    if pet.save
      {
        success: true,
        message: "Pet '#{pet.name}' cadastrado com sucesso!",
        pet: pet
      }
    else
      {
        success: false,
        message: "Erro ao cadastrar pet: #{pet.errors.full_messages.join(', ')}",
        pet: pet
      }
    end
  rescue StandardError => e
    {
      success: false,
      message: "Erro inesperado ao cadastrar pet: #{e.message}",
      pet: pet
    }
  end
end
```
---

### `app/decorators/autenticador_decorator.rb`
```ruby
# frozen_string_literal: true

# Decorador concreto que adiciona autentica√ß√£o antes do cadastro
# Responsabilidade: Verificar se o parceiro est√° autenticado antes de permitir o cadastro
class AutenticadorDecorator < CadastroPetDecorator
  # @param componente [CadastroPet] O componente a ser decorado
  # @param autenticado [Boolean] Se o usu√°rio est√° autenticado
  # @param parceiro [String, nil] Nome ou identifica√ß√£o do parceiro (opcional)
  def initialize(componente, autenticado:, parceiro: nil)
    super(componente)
    @autenticado = autenticado
    @parceiro = parceiro
  end

  # Adiciona comportamento de autentica√ß√£o antes de cadastrar
  # @param pet [Pet] O objeto pet a ser cadastrado
  # @return [Hash] Resultado da autentica√ß√£o e cadastro
  def cadastrar(pet)
    unless @autenticado
      mensagem = "Acesso negado! Parceiro n√£o autenticado."
      mensagem += " Usu√°rio: #{@parceiro}" if @parceiro
      
      Rails.logger.warn(mensagem)
      return {
        success: false,
        message: mensagem,
        pet: pet
      }
    end

    log_msg = "Parceiro autenticado"
    log_msg += " (#{@parceiro})" if @parceiro
    log_msg += " procedendo com o cadastro do pet '#{pet.name}'"
    Rails.logger.info(log_msg)

    # Se autenticado, delega para o pr√≥ximo componente na cadeia
    super(pet)
  end
end

```
---

### `app/decorators/cadastro_pet_decorator.rb`
```ruby
# frozen_string_literal: true

# Decorador base abstrato para cadastro de pets
# Implementa o padr√£o Decorator do GoF, mantendo refer√™ncia ao componente decorado
# e delegando a chamada para ele
class CadastroPetDecorator
  include CadastroPet

  # @param componente [CadastroPet] O componente a ser decorado
  def initialize(componente)
    @componente = componente
  end

  # Delega a chamada para o componente decorado
  # @param pet [Pet] O objeto pet a ser cadastrado
  # @return [Hash] Resultado do cadastro
  def cadastrar(pet)
    @componente.cadastrar(pet)
  end
end


```

---

### `app/decorators/notificador_decorator.rb`
```ruby
# frozen_string_literal: true

# Decorador concreto que adiciona notifica√ß√£o ap√≥s o cadastro bem-sucedido
# Responsabilidade: Enviar notifica√ß√µes ap√≥s o cadastro do pet
class NotificadorDecorator < CadastroPetDecorator
  # @param componente [CadastroPet] O componente a ser decorado
  # @param canal [String] Canal de notifica√ß√£o (email, sms, push, etc.)
  def initialize(componente, canal: 'email')
    super(componente)
    @canal = canal
  end

  # Adiciona comportamento de notifica√ß√£o ap√≥s cadastrar
  # @param pet [Pet] O objeto pet a ser cadastrado
  # @return [Hash] Resultado do cadastro com informa√ß√µes de notifica√ß√£o
  def cadastrar(pet)
    # Primeiro executa o cadastro (delega para o componente decorado)
    resultado = super(pet)

    # Se o cadastro foi bem-sucedido, envia notifica√ß√£o
    if resultado[:success]
      notificar(pet)
      resultado[:notificacao] = {
        enviada: true,
        canal: @canal,
        mensagem: "Notifica√ß√£o enviada com sucesso via #{@canal}"
      }
    else
      Rails.logger.info("Cadastro falhou, notifica√ß√£o n√£o ser√° enviada")
    end

    resultado
  end

  private

  # Simula o envio de notifica√ß√£o
  # @param pet [Pet] O pet que foi cadastrado
  def notificar(pet)
    mensagem = <<~MSG
      ========================================
      üìß NOTIFICA√á√ÉO DE CADASTRO (via #{@canal.upcase})
      ========================================
      Pet: #{pet.name}
      Esp√©cie: #{pet.species}
      Idade: #{pet.age} ano(s)
      Descri√ß√£o: #{pet.description || 'Sem descri√ß√£o'}
      
      O pet foi cadastrado com sucesso no sistema CuidaDeMim!
      Em breve estar√° dispon√≠vel para ado√ß√£o.
      ========================================
    MSG

    Rails.logger.info(mensagem)
    
    # Aqui voc√™ poderia integrar com servi√ßos reais de notifica√ß√£o:
    # - ActionMailer para emails
    # - Twilio para SMS
    # - Firebase para push notifications
    # Por enquanto, apenas logamos a notifica√ß√£o
  end
end


```

---
### `app/decorators/validador_decorator.rb`
```ruby
# frozen_string_literal: true

# Decorador concreto que adiciona valida√ß√£o de dados antes do cadastro
# Responsabilidade: Verificar se os dados do pet s√£o v√°lidos antes de prosseguir
class ValidadorDecorator < CadastroPetDecorator
  # Adiciona comportamento de valida√ß√£o antes de cadastrar
  # @param pet [Pet] O objeto pet a ser cadastrado
  # @return [Hash] Resultado da valida√ß√£o e cadastro
  def cadastrar(pet)
    resultado_validacao = validar_pet(pet)

    unless resultado_validacao[:valido]
      Rails.logger.warn("Valida√ß√£o falhou: #{resultado_validacao[:erros].join(', ')}")
      return {
        success: false,
        message: "Valida√ß√£o falhou: #{resultado_validacao[:erros].join(', ')}",
        pet: pet
      }
    end

    Rails.logger.info("Valida√ß√£o bem-sucedida para pet '#{pet.name}'")
    # Se v√°lido, delega para o pr√≥ximo componente na cadeia
    super(pet)
  end

  private

  # Valida os dados do pet
  # @param pet [Pet] O pet a ser validado
  # @return [Hash] Resultado da valida√ß√£o com status e lista de erros
  def validar_pet(pet)
    erros = []

    if pet.name.blank?
      erros << "Nome do pet n√£o pode estar vazio"
    end

    if pet.age.nil?
      erros << "Idade do pet deve ser informada"
    elsif pet.age.negative?
      erros << "Idade do pet deve ser um valor positivo"
    elsif pet.age > 30
      erros << "Idade do pet parece inv√°lida (muito alta)"
    end

    if pet.species.blank?
      erros << "Esp√©cie do pet n√£o pode estar vazia"
    end

    {
      valido: erros.empty?,
      erros: erros
    }
  end
end

```
---
## Conclus√£o

O uso do padr√£o Decorator neste m√≥dulo do sistema CuidaDeMim mostrou-se eficaz para estender funcionalidades de forma flex√≠vel e independente.
Cada responsabilidade ‚Äî valida√ß√£o, autentica√ß√£o e notifica√ß√£o ‚Äî foi isolada em decoradores distintos, mantendo o c√≥digo limpo, reutiliz√°vel e facilmente escal√°vel.

Essa abordagem promove ader√™ncia aos princ√≠pios SOLID, melhora a manutenibilidade do sistema e possibilita futuras extens√µes sem alterar a l√≥gica principal de cadastro de pets.

---
## Refer√™ncias
Gamma, E., Helm, R., Johnson, R., & Vlissides, J. Design Patterns: Elements of Reusable Object-Oriented Software. Addison-Wesley, 1994.

Documentation Ruby on Rails ‚Äì https://guides.rubyonrails.org/

Refactoring Guru ‚Äì Decorator Pattern: https://refactoring.guru/design-patterns/decorator


